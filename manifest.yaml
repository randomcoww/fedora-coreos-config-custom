include:
  - manifests/ignition-and-ostree.yaml
  - manifests/file-transfer.yaml
  - workstation-ostree-config/gnome-desktop-pkgs.yaml

releasever: "32"
ref: fedora/${releasever}/${basearch}/silverblue
rojig:
  name: fedora-silverblue
  summary: "Fedora Silverblue base image"
  license: MIT
automatic-version-prefix: "${releasever}"
mutate-os-release: "${releasever}"
boot-location: modules

initramfs-args:
  - --no-hostonly
  # We don't support root on NFS, so we don't need it in the initramfs. It also
  # conflicts with /var mount support in ignition because NFS tries to mount stuff
  # in /var/ and then ignition can't cleanly unmount it. For example:
  # https://github.com/dracutdevs/dracut/blob/1856ae95c873a6fe855b3dccd0144f1a96b9e71c/modules.d/95nfs/nfs-start-rpc.sh#L7
  # See also discussion in https://github.com/coreos/fedora-coreos-config/pull/60
  - --omit=nfs
  # Omit these since we don't use them
  - --omit=lvm
  - --omit=multipath
  - --omit=iscsi

recommends: false

ignore-removed-users:
  - root
ignore-removed-groups:
  - root
etc-group-members:
  - wheel
  - sudo
  - systemd-journal
  - adm
  - libvirt

check-passwd:
  type: "file"
  filename: "manifests/passwd"
check-groups:
  type: "file"
  filename: "manifests/group"

# ⚠⚠⚠ ONLY TEMPORARY HACKS ALLOWED HERE; ALL ENTRIES NEED TRACKER LINKS ⚠⚠⚠
# See also the version of this in fedora-coreos.yaml
postprocess:
  # Enable systemd-resolved
  - |
    #!/usr/bin/env bash
    set -xeuo pipefail
    ln -sf /run/systemd/resolve/resolv.conf /etc/resolv.conf

remove-from-packages:
  # Drop NetworkManager support for ifcfg files, see also corresponding
  # overlay.d/14NetworkManager-plugins
  - [NetworkManager, /usr/lib64/NetworkManager/.*/libnm-settings-plugin-ifcfg-rh.so]

repos:
  - fedora-coreos-pool
  # these repos are there to make it easier to add new packages to the OS and to
  # use `cosa fetch --update-lockfile`; but note that all package versions are
  # still pinned
  - fedora
  - fedora-modular
  - fedora-updates
  - fedora-updates-modular
  - fedora-rawhide
  - rpmfusion-free
  - rpmfusion-free-updates
  - rpmfusion-nonfree
  - gitlab.com_paulcarroty_vscodium_repo

packages:
  - afterburn
  - afterburn-dracut
  - socat ldns-utils
  # Podman
  - runc systemd-container catatonit
  - fuse-overlayfs slirp4netns
  - libvarlink-util
  # Storage
  - cloud-utils-growpart
  - iscsi-initiator-utils sg3_utils
  - device-mapper-multipath
  - xfsprogs
  - libsss_sudo
  #
  - xz gzip socat
  - iproute-tc
  - openssl
  - fuse-sshfs
  - coreos-installer
  - jq
  ### Custom
  - libva-utils xorg-x11-drv-amdgpu vulkan-tools
  - libvirt-daemon-kvm ksmtuned libvirt-client virt-viewer
  - kubernetes-client
  - hdparm lm_sensors
  - ipmitool
  - podman-compose
  - p7zip
  - nmap
  - strace
  - git-crypt
  - youtube-dl
  - htop
  - tmux xclip
  - vim-enhanced
  - gimp
  # External repo
  - mpv
  - codium
  - unrar

arch-include:
  x86_64: manifests/grub2-removals.yaml
  aarch64: manifests/grub2-removals.yaml
  ppc64le: manifests/grub2-removals.yaml